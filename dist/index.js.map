{"version":3,"sources":["../index.js"],"names":["decoder","devConfig","process","env","DEVELOPMENT_CONFIG","apiaiOptions","hostname","DEVELOPMENT_HOST","path","apiAiService","sessionIds","Map","controller","slackbot","debug","json_file_store","configureSlackApp","clientId","clientSecret","scopes","setupWebserver","err","webserver","createWebhookEndpoints","createOauthEndpoints","req","res","status","send","_bots","trackBot","bot","config","token","numberOfSpots","playersInGame","challengers","numberOfChallengeSpots","gameInProgress","edInsults","on","message","reply","api","users","info","user","error","response","name","arrayContains","updateNumberOfGamesPlayed","randomInsultIndex","Math","floor","random","length","actions","responseMessage","push","text","attachments","title","callback_id","attachment_type","color","shuffle","updateNumberOfWins","replyInteractive","startRTM","startPrivateConversation","createdBy","convo","say","storage","teams","all","Error","t","spawn","isDefined","obj","hears","type","identity","id","indexOf","requestText","decode","replace","channel","botId","userId","has","set","v1","request","textRequest","sessionId","get","contexts","parameters","slack_user_id","slack_channel","result","responseText","fulfillment","speech","responseData","data","action","startGame","showLeaderboard","slack","resp","end","command","allUserData","leaderboardMessage","sortedUserArray","sortByKey","map","index","numberOfGamesPlayed","array","currentIndex","temporaryValue","randomIndex","username","userData","save","parseInt","toString","numberOfWins","string","key","sort","a","b","x","y"],"mappings":"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","file":"index.js","sourcesContent":["'use strict'\r\n\r\nimport apiai from 'apiai'\r\nimport Botkit from 'botkit'\r\nimport { XmlEntities as Entities } from 'html-entities'\r\nimport uuid from 'node-uuid'\r\nimport { apiAiAccessToken, slackAppClientId, slackAppClientSecret } from './secrets'\r\n\r\nconst decoder = new Entities()\r\n\r\nconst devConfig = process.env.DEVELOPMENT_CONFIG === 'true'\r\n\r\nconst apiaiOptions = {}\r\nif (devConfig) {\r\n  apiaiOptions.hostname = process.env.DEVELOPMENT_HOST\r\n  apiaiOptions.path = '/api/query'\r\n}\r\n\r\nconst apiAiService = apiai(apiAiAccessToken, apiaiOptions)\r\n\r\nconst sessionIds = new Map()\r\n\r\nconst controller = Botkit.slackbot({\r\n  debug: devConfig,\r\n  json_file_store: './slackbot_storage'\r\n}).configureSlackApp(\r\n  {\r\n    clientId: slackAppClientId,\r\n    clientSecret: slackAppClientSecret,\r\n    scopes: ['bot', 'commands']\r\n  }\r\n)\r\n\r\ncontroller.setupWebserver(3000, (err, webserver) => {\r\n  controller.createWebhookEndpoints(controller.webserver)\r\n  controller.createOauthEndpoints(controller.webserver, function (err, req, res) {\r\n    if (err) {\r\n      res.status(500).send('ERROR: ' + err)\r\n    } else {\r\n      res.send('Success!')\r\n    }\r\n  })\r\n})\r\n\r\n// just a simple way to make sure we don't\r\n// connect to the RTM twice for the same team\r\nlet _bots = {}\r\n\r\nfunction trackBot (bot) {\r\n  _bots[bot.config.token] = bot\r\n}\r\n\r\n// Game variables\r\nlet numberOfSpots = 4\r\nlet playersInGame = []\r\nlet challengers = []\r\nlet numberOfChallengeSpots = 2\r\nlet gameInProgress = false\r\nlet edInsults = [\r\n  '@edwardvincent Are you sure that is wise? :flushed:',\r\n  '@edwardvincent Are you sure? :flushed:',\r\n  '@edwardvincent Really?!! :flushed:',\r\n  '@edwardvincent When will you learn? :flushed:',\r\n  '@edwardvincent It just makes me sad :cry:'\r\n]\r\n\r\ncontroller.on('interactive_message_callback', function (bot, message) {\r\n  let reply\r\n  bot.api.users.info({user: message.user}, (error, response) => {\r\n    let {name} = response.user\r\n    if (arrayContains(name, playersInGame) && !devConfig) {\r\n      bot.reply(message, `@${name} You are already in the game. You can't join twice. :no_entry_sign:`)\r\n    } else {\r\n      updateNumberOfGamesPlayed(name)\r\n      if (name === 'edwardvincent') {\r\n        let randomInsultIndex = Math.floor(Math.random() * edInsults.length)\r\n        bot.reply(message, edInsults[randomInsultIndex])\r\n      }\r\n\r\n      if (message.actions[0].name === 'join') {\r\n        let responseMessage = ''\r\n\r\n        numberOfSpots--\r\n        playersInGame.push(name)\r\n        if (numberOfSpots > 1) {\r\n          responseMessage = `${numberOfSpots} more spots to go... :timer_clock: @${name} - joined`\r\n        } else if (numberOfSpots === 1) {\r\n          responseMessage = `${numberOfSpots} more spot to go! Ahhhhh!!! :scream_cat: @${name} - joined`\r\n        } else {\r\n          responseMessage = `:no_good: too slow! :turtle:`\r\n        }\r\n\r\n        reply = {\r\n          text: responseMessage,\r\n          attachments: [{\r\n            title: 'Click to join while there is space!',\r\n            callback_id: message.user,\r\n            attachment_type: 'default',\r\n            color: '#09b600',\r\n            actions: [{\r\n              'name': 'join',\r\n              'style': 'primary',\r\n              'text': ':tada: Join',\r\n              'value': '1',\r\n              'type': 'button'\r\n            }]\r\n          }, {\r\n            title: 'Players in the game:',\r\n            text: `${playersInGame[0]} ${playersInGame[1]} ${playersInGame[2] ? playersInGame[2] : ''}`,\r\n            color: '#4942ff'\r\n          }]\r\n        }\r\n\r\n        if (numberOfSpots === 0) {\r\n          shuffle(playersInGame)\r\n          reply = {\r\n            text: 'Awesome! All spots are filled! :+1:',\r\n            attachments: [{\r\n              title: 'Who won?',\r\n              text: `:foos: Black: @${playersInGame[0]} & @${playersInGame[1]}\\n\r\n              :vs:\\n\r\n              :foos: White: @${playersInGame[2]} & @${playersInGame[3]}`,\r\n              callback_id: message.user,\r\n              attachment_type: 'default',\r\n              color: '#09b600',\r\n              actions: [{\r\n                'name': 'black_won',\r\n                'style': 'primary',\r\n                'text': 'Black won',\r\n                'value': '1',\r\n                'type': 'button'\r\n              }, {\r\n                'name': 'white_won',\r\n                'style': 'primary',\r\n                'text': 'White won',\r\n                'value': '1',\r\n                'type': 'button'\r\n              }, {\r\n                'name': 'challenge',\r\n                'style': 'primary',\r\n                'text': `Challenge`,\r\n                'value': '1',\r\n                'type': 'button'\r\n              }]\r\n            }]\r\n          }\r\n        }\r\n      } else if (message.actions[0].name === 'black_won' || message.actions[0].name === 'white_won') {\r\n        if (message.actions[0].name === 'black_won') {\r\n          updateNumberOfWins(playersInGame[0])\r\n          updateNumberOfWins(playersInGame[1])\r\n          reply = {\r\n            text: `Congrats ${playersInGame[0]} & ${playersInGame[1]}`,\r\n            attachments: []\r\n          }\r\n        } else {\r\n          updateNumberOfWins(playersInGame[2])\r\n          updateNumberOfWins(playersInGame[3])\r\n          reply = {\r\n            text: `Congrats ${playersInGame[2]} & ${playersInGame[3]}`,\r\n            attachments: []\r\n          }\r\n        }\r\n\r\n        // Clear the game\r\n        gameInProgress = false\r\n        playersInGame = []\r\n      } else {\r\n        numberOfChallengeSpots--\r\n        challengers.push(name)\r\n        reply = {\r\n          text: `Challenge  @${name} - challenged`,\r\n          attachments: [{\r\n            title: 'Who won?',\r\n            text: `Here is a random team assignment if you would like to use it?\\n\r\n          :foos: Black: @${playersInGame[0]} & @${playersInGame[1]}\\n\r\n          :vs:\\n\r\n          :foos: White: @${playersInGame[2]} & @${playersInGame[3]}`,\r\n            callback_id: message.user,\r\n            attachment_type: 'default',\r\n            color: '#09b600',\r\n            actions: [{\r\n              'name': 'join',\r\n              'style': 'primary',\r\n              'text': 'Black won',\r\n              'value': '1',\r\n              'type': 'button'\r\n            }, {\r\n              'name': 'join',\r\n              'style': 'primary',\r\n              'text': 'White won',\r\n              'value': '1',\r\n              'type': 'button'\r\n            }, {\r\n              'name': 'challenge',\r\n              'style': 'primary',\r\n              'text': `Challenge`,\r\n              'value': '2',\r\n              'type': 'button'\r\n            }]\r\n          }]\r\n        }\r\n      }\r\n\r\n      bot.replyInteractive(message, reply)\r\n    }\r\n  })\r\n})\r\n\r\ncontroller.on('create_bot', (bot, config) => {\r\n  if (_bots[bot.config.token]) {\r\n    // already online! do nothing.\r\n  } else {\r\n    bot.startRTM(function (err) {\r\n      if (!err) {\r\n        trackBot(bot)\r\n      }\r\n\r\n      bot.startPrivateConversation({user: config.createdBy}, function (err, convo) {\r\n        if (err) {\r\n          console.log(err)\r\n        } else {\r\n          convo.say('I am a bot that has just joined your team')\r\n          convo.say('You must now /invite me to a channel so that I can be of use!')\r\n        }\r\n      })\r\n    })\r\n  }\r\n})\r\n\r\n// Handle events related to the websocket connection to Slack\r\ncontroller.on('rtm_open', bot => {\r\n  console.log('** The RTM api just connected!')\r\n})\r\n\r\ncontroller.on('rtm_close', bot => {\r\n  console.log('** The RTM api just closed')\r\n  // you may want to attempt to re-open\r\n})\r\n\r\ncontroller.storage.teams.all((err, teams) => {\r\n  if (err) {\r\n    throw new Error(err)\r\n  }\r\n\r\n  // connect all teams with bots up to slack!\r\n  for (let t in teams) {\r\n    if (teams[t].bot) {\r\n      controller.spawn(teams[t]).startRTM(function (err, bot) {\r\n        if (err) {\r\n          console.log('Error connecting bot to Slack:', err)\r\n        } else {\r\n          trackBot(bot)\r\n        }\r\n      })\r\n    }\r\n  }\r\n})\r\n\r\n/**\r\n * Check if defined pollyfil\r\n * @param obj\r\n * @returns {boolean}\r\n */\r\nfunction isDefined (obj) {\r\n  if (typeof obj === 'undefined') {\r\n    return false\r\n  }\r\n\r\n  if (!obj) {\r\n    return false\r\n  }\r\n\r\n  return obj !== null\r\n}\r\n\r\n/**\r\n * Listen for direction messages and all mentions @foos-bot\r\n * Fire off the correct functions based on the type of request that was made\r\n */\r\ncontroller.hears(['.*'], ['direct_message', 'direct_mention', 'mention'], (bot, message) => {\r\n  try {\r\n    if (message.type === 'message') {\r\n      if (message.user === bot.identity.id) {\r\n        // message from bot can be skipped\r\n      } else if (message.text.indexOf('<@U') === 0 && message.text.indexOf(bot.identity.id) === -1) {\r\n        // skip other users direct mentions\r\n      } else {\r\n        let requestText = decoder.decode(message.text)\r\n        requestText = requestText.replace('â€™', '\\'')\r\n\r\n        let channel = message.channel\r\n        let botId = '<@' + bot.identity.id + '>'\r\n        let userId = message.user\r\n\r\n        if (requestText.indexOf(botId) > -1) {\r\n          requestText = requestText.replace(botId, '')\r\n        }\r\n\r\n        if (!sessionIds.has(channel)) {\r\n          sessionIds.set(channel, uuid.v1())\r\n        }\r\n\r\n        let request = apiAiService.textRequest(requestText,\r\n          {\r\n            sessionId: sessionIds.get(channel),\r\n            contexts: [\r\n              {\r\n                name: 'generic',\r\n                parameters: {\r\n                  slack_user_id: userId,\r\n                  slack_channel: channel\r\n                }\r\n              }\r\n            ]\r\n          })\r\n\r\n        request.on('response', (response) => {\r\n          if (isDefined(response.result)) {\r\n            let responseText = response.result.fulfillment.speech\r\n            let responseData = response.result.fulfillment.data\r\n            let action = response.result.action\r\n\r\n            if (action === 'start_game' || action === 'join_game') {\r\n              startGame(bot, message)\r\n            } else if (action === 'show_leaderboard') { // show who has played the most games\r\n              showLeaderboard(bot, message, responseText)\r\n            } else if (action === 'check_number_of_players_in_game') { // check the number of spots remaining\r\n              if (!gameInProgress) {\r\n                bot.reply(message, 'There is no game in progress - so 4 spots')\r\n              } else {\r\n                bot.reply(message, 'There are ' + numberOfSpots + ' remaining...')\r\n              }\r\n            } else if (action === 'get_help') {\r\n              bot.reply(message, responseText)\r\n            } else if (isDefined(responseData) && isDefined(responseData.slack)) {\r\n              try {\r\n                bot.reply(message, responseData.slack)\r\n              } catch (err) {\r\n                bot.reply(err.message)\r\n              }\r\n            } else if (isDefined(responseText)) {\r\n              bot.reply(responseText, (err, resp) => {\r\n                if (err) {\r\n                  console.error(err)\r\n                }\r\n              })\r\n            }\r\n          }\r\n        })\r\n\r\n        request.on('error', (error) => console.error(error))\r\n        request.end()\r\n      }\r\n    }\r\n  } catch\r\n    (err) {\r\n    console.error(err)\r\n  }\r\n})\r\n\r\ncontroller.on('slash_command', (bot, message) => {\r\n  if (message.command === '/new-foos') {\r\n    startGame(bot, message)\r\n  } else if (message.command === '/clear-all-foos') {\r\n    gameInProgress = false\r\n    numberOfSpots = 4\r\n    numberOfChallengeSpots = 2\r\n    playersInGame = []\r\n    challengers = []\r\n  }\r\n})\r\n\r\n/**\r\n * Starts a new game\r\n * @param bot\r\n * @param message\r\n */\r\nfunction startGame (bot, message) {\r\n  // If there is a game in progress don't start a new one\r\n  if (gameInProgress) {\r\n    return bot.reply(message, 'There is already a game in progress -  please join that one')\r\n  }\r\n  gameInProgress = true\r\n  numberOfSpots = 3\r\n  numberOfChallengeSpots = 2\r\n  playersInGame = []\r\n  challengers = []\r\n\r\n  bot.api.users.info({user: message.user}, (error, response) => {\r\n    let reply = {\r\n      text: `New game created by  @${response.user.name} :tada:`,\r\n      attachments: [{\r\n        title: 'Click to join while there is space!',\r\n        callback_id: message.user,\r\n        attachment_type: 'default',\r\n        color: '#09b600',\r\n        actions: [\r\n          {\r\n            'name': 'join',\r\n            'style': 'primary',\r\n            'text': ':tada: Join',\r\n            'value': '1',\r\n            'type': 'button'\r\n          }\r\n        ]\r\n      }]\r\n    }\r\n\r\n    bot.reply(message, reply)\r\n\r\n    // Add the person who sent the message to the game\r\n    playersInGame.push(response.user.name)\r\n    updateNumberOfGamesPlayed(response.user.name)\r\n  })\r\n}\r\n\r\n/**\r\n * Fetches the stats around number of games played, sorts it and returns it as a message\r\n * @param bot\r\n * @param message\r\n */\r\nfunction showLeaderboard (bot, message) {\r\n  controller.storage.users.all((error, allUserData) => {\r\n    if (error) {\r\n      console.log(error)\r\n    }\r\n    let leaderboardMessage = ''\r\n    let sortedUserArray = sortByKey(allUserData, 'numberOfGamesPlayed')\r\n    sortedUserArray.map((user, index) => {\r\n      leaderboardMessage += `${index + 1}) ${user.id} *${user.numberOfGamesPlayed}* \\n`\r\n    })\r\n    bot.reply(message, leaderboardMessage)\r\n  })\r\n}\r\n\r\n/**\r\n * Shuffles an array\r\n * @param array\r\n * @returns {*}\r\n */\r\nfunction shuffle (array) {\r\n  let currentIndex = array.length\r\n  let temporaryValue\r\n  let randomIndex\r\n\r\n  // While there remain elements to shuffle...\r\n  while (currentIndex !== 0) {\r\n    // Pick a remaining element...\r\n    randomIndex = Math.floor(Math.random() * currentIndex)\r\n    currentIndex -= 1\r\n\r\n    // And swap it with the current element.\r\n    temporaryValue = array[currentIndex]\r\n    array[currentIndex] = array[randomIndex]\r\n    array[randomIndex] = temporaryValue\r\n  }\r\n\r\n  return array\r\n}\r\n\r\n/**\r\n * Saves the number of games played to a local db\r\n * @param username\r\n */\r\nfunction updateNumberOfGamesPlayed (username) {\r\n  controller.storage.users.get(username, function (error, userData) {\r\n    if (error) {\r\n      console.log(error)\r\n    }\r\n    if (userData) {\r\n      controller.storage.users.save({\r\n        id: username,\r\n        numberOfGamesPlayed: (parseInt(userData.numberOfGamesPlayed, 10) + 1).toString()\r\n      }, function (err) {\r\n        if (err) {\r\n          console.log(err, 'user data not saved')\r\n        }\r\n      })\r\n    } else {\r\n      controller.storage.users.save({id: username, numberOfGamesPlayed: 1}, function (err) {\r\n        if (err) {\r\n          console.log(err, 'user data not saved')\r\n        }\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\n/**\r\n * Saves the number of games played to a local db\r\n * @param username\r\n */\r\nfunction updateNumberOfWins (username) {\r\n  controller.storage.users.get(username, (error, userData) => {\r\n    if (error) {\r\n      console.log(error)\r\n    }\r\n    if (userData) {\r\n      controller.storage.users.save({\r\n        id: username,\r\n        numberOfWins: (parseInt(userData.numberOfWins, 10) + 1).toString()\r\n      }, function (err) {\r\n        if (err) {\r\n          console.log(err, 'user data not saved')\r\n        }\r\n      })\r\n    } else {\r\n      controller.storage.users.save({id: username, numberOfWins: 1}, function (err) {\r\n        if (err) {\r\n          console.log(err, 'user data not saved')\r\n        }\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\n/**\r\n * Check if a string is in an array\r\n * @param string\r\n * @param array\r\n * @returns {boolean}\r\n */\r\nfunction arrayContains (string, array) {\r\n  return (array.indexOf(string) > -1)\r\n}\r\n\r\n/**\r\n * Sort array (leaderboard) by key\r\n * @param array\r\n * @param key\r\n * @returns {Array.<T>}\r\n */\r\nfunction sortByKey (array, key) {\r\n  return array.sort(function (a, b) {\r\n    let x = parseInt(a[key])\r\n    let y = parseInt(b[key])\r\n    return ((x > y) ? -1 : ((x < y) ? 1 : 0))\r\n  })\r\n}\r\n"]}