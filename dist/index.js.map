{"version":3,"sources":["../index.js"],"names":["settings","token","name","bot","params","icon_emoji","channelOrGroup","postOrGroupName","numberOfSpots","playersInGame","gameInProgress","sendMessage","messageText","postMessageToChannel","postMessageToGroup","on","data","text","toUpperCase","startsWith","setTimeout","console","log"],"mappings":";;AAAA;;AACA;;;;;;AAEA;AACA,IAAMA,WAAW;AACbC,yBADa;AAEbC,UAAM;AAFO,CAAjB;;AAKA,IAAMC,MAAM,wBAAQH,QAAR,CAAZ;;AAEA;AACA,IAAMI,SAAS;AACXC,gBAAY;AADD,CAAf;;AAIA;AACA,IAAMC,iBAAiB,SAAvB;AACA,IAAMC,kBAAkB,SAAxB;;AAEA;AACA,IAAIC,gBAAgB,CAApB;AACA,IAAIC,gBAAgB,EAApB;AACA,IAAIC,iBAAiB,KAArB;;AAEA;AACA,SAASC,WAAT,CAAqBC,WAArB,EAAkC;AAC9B,QAAIN,mBAAmB,SAAvB,EAAkC;AAC9BH,YAAIU,oBAAJ,CAAyBN,eAAzB,EAA0CK,WAA1C,EAAuDR,MAAvD;AACH,KAFD,MAGK;AACDD,YAAIW,kBAAJ,CAAuBP,eAAvB,EAAwCK,WAAxC,EAAqDR,MAArD;AACH;AACJ;;AAEDD,IAAIY,EAAJ,CAAO,SAAP,EAAkB,UAAUC,IAAV,EAAgB;AAC9B;AACA;;AAEA;AACA,QAAIA,KAAKC,IAAT,EAAe;AACX;AACA,YAAID,KAAKC,IAAL,CAAUC,WAAV,GAAwBC,UAAxB,CAAmC,6BAAnC,CAAJ,EAAuE;AACnE;AACA,gBAAI,CAACT,cAAL,EAAqB;AACjBU,2BAAW,YAAY;AACnB;AACA,wBAAIZ,gBAAgB,CAApB,EAAuB;AACnBG,oCAAY,kCAAkCH,aAAlC,GAAkD,kBAA9D;AACH;AACD;AACAY,+BAAW,YAAY;AACnB,4BAAIV,cAAJ,EAAoB;AAChBA,6CAAiB,KAAjB;AACAC,wCAAY,0CAAZ;AACH;AACJ,qBALD,EAKG,KALH;AAMH,iBAZD,EAYG,MAZH;AAaAD,iCAAiB,IAAjB;AACAF,gCAAgB,CAAhB;AACAG,4BAAY,gHAAZ;AACH,aAjBD,MAiBO;AACHA,4BAAY,gGAAZ;AACH;AACJ;;AAED;AAxBA,aAyBK,IAAIK,KAAKC,IAAL,CAAUC,WAAV,GAAwBC,UAAxB,CAAmC,iBAAnC,CAAJ,EAA2D;AAC5DE,wBAAQC,GAAR,CAAY,sBAAZ;AACA,oBAAIZ,cAAJ,EAAoB;AAChB,wBAAIF,iBAAiB,CAArB,EAAwB;AACpBA;AACH;AACD,wBAAIA,gBAAgB,CAApB,EAAuB;AACnBG,oCAAYH,gBAAgB,sBAA5B;AACH,qBAFD,MAGK,IAAIA,kBAAkB,CAAtB,EAAyB;AAC1BG,oCAAYH,gBAAgB,6BAA5B;AACH,qBAFI,MAGA,IAAIA,kBAAkB,CAAtB,EAAyB;AAC1BG,oCAAY,gCAAZ;AACAD,yCAAiB,KAAjB;AACH,qBAHI,MAIA,IAAIF,gBAAgB,CAApB,EAAuB;AACxBG,oCAAY,gFAAZ;AACH;AACJ,iBAjBD,MAkBK;AACDA,gCAAY,6GAAZ;AACH;AACJ;;AAED;AAzBK,iBA0BA,IAAIK,KAAKC,IAAL,CAAUC,WAAV,GAAwBC,UAAxB,CAAmC,6BAAnC,CAAJ,EAAuE;AACxER,gCAAY,eAAeH,aAAf,GAA+B,eAA3C;AACH;;AAED;AAJK,qBAKA,IAAIQ,KAAKC,IAAL,CAAUC,WAAV,GAAwBC,UAAxB,CAAmC,mBAAnC,CAAJ,EAA6D;AAC9DR,oCAAY,yXAAZ;AACH;;AAED;AAJK,yBAKA,IAAIK,KAAKC,IAAL,CAAUC,WAAV,GAAwBC,UAAxB,CAAmC,cAAnC,CAAJ,EAAwD;AACzDR,wCAAY,mDAAZ;AACH;AACJ;AACJ,CAxED","file":"index.js","sourcesContent":["import {TOKEN} from \"./secrets\";\nimport Bot from \"slackbots\";\n\n// create a bot\nconst settings = {\n    token: TOKEN,\n    name: 'FoosBot'\n};\n\nconst bot = new Bot(settings);\n\n// give him a face\nconst params = {\n    icon_emoji: ':robot_face:'\n};\n\n// define group or channel that we are posting to\nconst channelOrGroup = 'channel';\nconst postOrGroupName = 'general';\n\n// game vars\nlet numberOfSpots = 4;\nlet playersInGame = [];\nlet gameInProgress = false;\n\n// function to send a message to either a group (private channel) or a channel\nfunction sendMessage(messageText) {\n    if (channelOrGroup === 'channel') {\n        bot.postMessageToChannel(postOrGroupName, messageText, params);\n    }\n    else {\n        bot.postMessageToGroup(postOrGroupName, messageText, params);\n    }\n}\n\nbot.on('message', function (data) {\n    // all ingoing events https://api.slack.com/rtm\n    //console.log(data);\n\n    // check that the message has text\n    if (data.text) {\n        // start a new game if there isn't one in progress\n        if (data.text.toUpperCase().startsWith('<@U3A62AGH4> I WANT TO FOOS')) {\n            // check if there is a game running\n            if (!gameInProgress) {\n                setTimeout(function () {\n                    // let users know that time is running out\n                    if (numberOfSpots > 0) {\n                        sendMessage('30 seconds to go and we need ' + numberOfSpots + ' more players...');\n                    }\n                    // close game if its been 5 mins and we didn't get enough players\n                    setTimeout(function () {\n                        if (gameInProgress) {\n                            gameInProgress = false;\n                            sendMessage('Game closed before we got enough players');\n                        }\n                    }, 30000);\n                }, 270000);\n                gameInProgress = true;\n                numberOfSpots = 3;\n                sendMessage('Alright! Lets go! The next 3 players to reply \"@foos-bot in\" will be in the next game.. Fastest foosers first!');\n            } else {\n                sendMessage('Sorry there is already a game in progress.. Join that one or wait 5 minutes for it to expire..');\n            }\n        }\n\n        // join an existing game\n        else if (data.text.toUpperCase().startsWith('<@U3A62AGH4> IN')) {\n            console.log('user joining game...');\n            if (gameInProgress) {\n                if (numberOfSpots >= 0) {\n                    numberOfSpots--;\n                }\n                if (numberOfSpots > 1) {\n                    sendMessage(numberOfSpots + ' more spots to go...');\n                }\n                else if (numberOfSpots === 1) {\n                    sendMessage(numberOfSpots + ' more spot to go! Ahhhhh!!!');\n                }\n                else if (numberOfSpots === 0) {\n                    sendMessage('Awesome! All spots are filled!');\n                    gameInProgress = false;\n                }\n                else if (numberOfSpots < 0) {\n                    sendMessage('Sorry you are too late but don\\'t worry about it - its only natural selection.');\n                }\n            }\n            else {\n                sendMessage('There is no game in progress at the moment. You can send \"@foos-bot I want to foos!\" to start a new game...');\n            }\n        }\n\n        // check the number of spots remaining\n        else if (data.text.toUpperCase().startsWith(\"<@U3A62AGH4> HOW MANY SPOTS\")) {\n            sendMessage('There are ' + numberOfSpots + ' remaining...');\n        }\n\n        // get help\n        else if (data.text.toUpperCase().startsWith('<@U3A62AGH4> HELP')) {\n            sendMessage('Hi there! I\\'m foosbot.\\nMy job is pretty simple. Just say \\'@foos-bot I want to foos!\\' and I\\'ll create a new game for you. The user that sent the message will be player 1 and the next 3 to reply \\'@foos-bot I\\'m in\\' will get a place in the game. Games expire after 5 minutes.\\n Send \\'@foos-bot how many spots?\\' to see the number of places remaining in the current game.');\n        }\n\n        // let the user know that the message was rx'd but foos-bot didn't know what to do with it\n        else if (data.text.toUpperCase().startsWith('<@U3A62AGH4>')) {\n            sendMessage('huh? send \\'@foos-bot help\\' to see what I can do');\n        }\n    }\n});\n"]}